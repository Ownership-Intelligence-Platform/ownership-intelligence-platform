<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Person Network</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            keyframes: {
              breath: {
                "0%, 100%": { transform: "scale(1)", filter: "brightness(1)" },
                "50%": { transform: "scale(1.05)", filter: "brightness(1.1)" },
              },
              scan: {
                "0%, 100%": { transform: "rotate(0deg) translateX(0)" },
                "25%": { transform: "rotate(-15deg) translateX(-3px)" },
                "75%": { transform: "rotate(15deg) translateX(3px)" },
              },
            },
            animation: {
              breath: "breath 3s ease-in-out infinite",
              scan: "scan 2.5s ease-in-out infinite",
            },
          },
        },
      };
    </script>
    <script src="/static/d3@7.js"></script>
  </head>
  <body
    class="min-h-screen bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 font-sans"
  >
    <!-- Global Loading Overlay -->
    <div
      id="globalLoader"
      class="fixed inset-0 z-[100] bg-slate-50/80 dark:bg-slate-950/80 backdrop-blur-sm flex flex-col items-center justify-center transition-opacity duration-300 opacity-0 pointer-events-none"
    >
      <div class="relative">
        <!-- Outer Glow -->
        <div
          class="absolute inset-0 bg-indigo-500 blur-3xl opacity-20 animate-pulse rounded-full"
        ></div>

        <svg
          class="relative w-32 h-32 drop-shadow-2xl"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <linearGradient
              id="shieldGradLoader"
              x1="4"
              y1="2"
              x2="20"
              y2="22"
              gradientUnits="userSpaceOnUse"
            >
              <stop stop-color="#4f46e5" />
              <stop offset="1" stop-color="#7c3aed" />
            </linearGradient>
          </defs>

          <!-- Shield Background with breathing animation -->
          <g class="origin-center animate-[breath_3s_ease-in-out_infinite]">
            <path
              d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"
              fill="url(#shieldGradLoader)"
            />
          </g>

          <!-- Inner Content -->
          <g
            stroke="white"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <!-- Network Nodes with sequential pulsing -->
            <g>
              <circle
                cx="12"
                cy="9"
                r="1.2"
                fill="white"
                stroke="none"
                class="animate-[ping_2s_cubic-bezier(0,0,0.2,1)_infinite]"
                style="animation-delay: 0s; transform-origin: 12px 9px"
              />
              <circle cx="12" cy="9" r="1.2" fill="white" stroke="none" />

              <circle
                cx="8.5"
                cy="13.5"
                r="1.2"
                fill="white"
                stroke="none"
                class="animate-[ping_2s_cubic-bezier(0,0,0.2,1)_infinite]"
                style="animation-delay: 0.5s; transform-origin: 8.5px 13.5px"
              />
              <circle cx="8.5" cy="13.5" r="1.2" fill="white" stroke="none" />

              <path d="M12 9L8.5 13.5M12 9l3.5 4.5" class="opacity-80" />
            </g>

            <!-- Magnifier with scanning animation -->
            <g
              class="origin-[15.5px_13.5px] animate-[scan_2.5s_ease-in-out_infinite]"
            >
              <circle cx="15.5" cy="13.5" r="2" />
              <path d="M17 15l1.5 1.5" />
            </g>
          </g>
        </svg>
      </div>
      <div class="mt-8 flex flex-col items-center gap-2">
        <h3
          class="text-xl font-bold text-slate-800 dark:text-white tracking-tight"
        >
          智网 AI
        </h3>
        <p
          class="text-sm text-indigo-600 dark:text-indigo-400 font-medium animate-pulse"
        >
          正在分析数据...
        </p>
      </div>
    </div>

    <header
      class="sticky top-0 z-30 bg-white/80 dark:bg-gray-900/80 backdrop-blur border-b border-gray-200 dark:border-gray-800"
    >
      <div
        class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between"
      >
        <h1 class="text-lg font-semibold">Person Relationship Network</h1>
        <a href="/" class="text-sm text-indigo-600 hover:underline"
          >Back to Dashboard</a
        >
      </div>
    </header>
    <main class="max-w-6xl mx-auto px-4 py-6 space-y-6">
      <section
        class="rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-sm p-4"
      >
        <div class="flex flex-wrap items-end gap-4">
          <label class="block">
            <span
              class="block text-xs uppercase tracking-wide text-gray-600 dark:text-gray-300"
              >Person ID</span
            >
            <input
              id="personId"
              class="mt-1 w-48 rounded-md border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
              placeholder="e.g., P1"
            />
          </label>
          <button
            id="loadNetwork"
            class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-white shadow hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
          >
            Load Network
          </button>
          <span
            id="status"
            class="text-xs text-gray-600 dark:text-gray-300"
          ></span>
        </div>
      </section>
      <section
        class="rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-sm p-4"
      >
        <h2 class="text-base font-semibold mb-3">人际关系概览</h2>
        <div
          id="relationsCard"
          class="text-sm grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3"
        >
          <!-- Filled by JS: categories like 父母/子女/朋友/同学/配偶/同事 with counts -->
        </div>
        <div class="mt-2 text-[11px] text-gray-500 dark:text-gray-400">
          注：同事来源于“共享同一公司”的关系；其他关系需要在图谱中维护后显示。
        </div>
      </section>
      <section
        class="rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-sm p-4"
      >
        <h2 class="text-base font-semibold mb-3">Graph</h2>
        <div
          id="graph"
          class="w-full h-[600px] overflow-hidden rounded border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-800"
        ></div>
        <div class="mt-2 text-xs text-gray-600 dark:text-gray-300" id="legend">
          <strong>Legend:</strong> Circles = Persons, Squares = Companies. Blue
          links: LEGAL_REP. Emerald links: SERVES_AS. Gray links: SHARE_COMPANY
          (persons share at least one company).
        </div>
      </section>
      <section
        class="rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-sm p-4"
      >
        <h2 class="text-base font-semibold mb-3">开户信息（去标识化）</h2>
        <div
          id="accountOpening"
          class="text-sm text-gray-700 dark:text-gray-200"
        >
          <em>加载后显示该人员的开户信息（仅展示已去标识化数据）。</em>
        </div>
        <div class="mt-2 text-[11px] text-gray-500 dark:text-gray-400">
          提示：账号与身份证号仅展示尾号，避免暴露敏感信息。
        </div>
      </section>
      <!-- Additional person-related cards: accounts, transactions, employment, news -->
      <section
        class="rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-sm p-4"
      >
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-base font-semibold">账户</h2>
          <button
            id="loadAccounts"
            class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white"
          >
            刷新
          </button>
        </div>
        <div id="accountsList" class="text-sm text-gray-700 dark:text-gray-200">
          <em>账户信息加载中…</em>
        </div>
      </section>

      <section
        class="rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-sm p-4"
      >
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-base font-semibold">交易</h2>
          <div class="flex items-center gap-2">
            <select
              id="txDirection"
              class="rounded border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm px-2 py-1"
            >
              <option value="out" selected>出</option>
              <option value="in">入</option>
              <option value="both">双向</option>
            </select>
            <button
              id="loadTransactions"
              class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white"
            >
              刷新
            </button>
          </div>
        </div>
        <div
          id="transactionsList"
          class="text-sm text-gray-700 dark:text-gray-200"
        >
          <em>交易信息加载中…</em>
        </div>
      </section>

      <section
        class="rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-sm p-4"
      >
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-base font-semibold">任职信息</h2>
          <div class="flex items-center gap-2">
            <select
              id="employmentRole"
              class="rounded border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm px-2 py-1"
            >
              <option value="both" selected>全部</option>
              <option value="as_company">公司</option>
              <option value="as_person">个人</option>
            </select>
            <button
              id="loadEmployment"
              class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white"
            >
              刷新
            </button>
          </div>
        </div>
        <div
          id="employmentList"
          class="text-sm text-gray-700 dark:text-gray-200"
        >
          <em>任职信息加载中…</em>
        </div>
      </section>

      <section
        class="rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-sm p-4 lg:col-span-2"
      >
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-base font-semibold">相关新闻</h2>
          <div class="flex items-center gap-2">
            <input
              id="newsLimit"
              type="number"
              value="5"
              min="1"
              max="50"
              class="w-20 rounded-md border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-2 py-1 text-sm"
            />
            <button
              id="loadNews"
              class="inline-flex items-center rounded-md bg-slate-700 px-3 py-1.5 text-sm font-medium text-white"
            >
              刷新
            </button>
          </div>
        </div>
        <div id="newsList" class="text-sm text-gray-700 dark:text-gray-200">
          <em>相关新闻加载中…</em>
        </div>
      </section>
      <section
        class="rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-sm p-4"
      >
        <h2 class="text-base font-semibold mb-3">Raw Data</h2>
        <pre id="raw" class="text-xs whitespace-pre-wrap"></pre>
      </section>
    </main>
    <script type="module" src="/static/modules/personNetwork.js"></script>
  </body>
</html>
